/*! For license information please see globocom-horizon.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.horizon=e():t.horizon=e()}(self,(()=>(()=>{var t={914:function(t,e,r){var n;t=r.nmd(t),function(){var o=(t&&t.exports,"object"==typeof r.g&&r.g);o.global!==o&&o.window;var i=function(t){this.message=t};(i.prototype=new Error).name="InvalidCharacterError";var a=function(t){throw new i(t)},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=/[\t\n\f\r ]/g,s={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var e,r,n,o,i=t.length%3,c="",s=-1,l=t.length-i;++s<l;)e=t.charCodeAt(s)<<16,r=t.charCodeAt(++s)<<8,n=t.charCodeAt(++s),c+=u.charAt((o=e+r+n)>>18&63)+u.charAt(o>>12&63)+u.charAt(o>>6&63)+u.charAt(63&o);return 2==i?(e=t.charCodeAt(s)<<8,r=t.charCodeAt(++s),c+=u.charAt((o=e+r)>>10)+u.charAt(o>>4&63)+u.charAt(o<<2&63)+"="):1==i&&(o=t.charCodeAt(s),c+=u.charAt(o>>2)+u.charAt(o<<4&63)+"=="),c},decode:function(t){var e=(t=String(t).replace(c,"")).length;e%4==0&&(e=(t=t.replace(/==?$/,"")).length),(e%4==1||/[^+a-zA-Z0-9/]/.test(t))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,o=0,i="",s=-1;++s<e;)n=u.indexOf(t.charAt(s)),r=o%4?64*r+n:n,o++%4&&(i+=String.fromCharCode(255&r>>(-2*o&6)));return i},version:"0.1.0"};void 0===(n=function(){return s}.call(e,r,e,t))||(t.exports=n)}()},92:(t,e,r)=>{"use strict";r(491).polyfill()},491:t=>{"use strict";function e(t,e){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var r=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var i=Object.keys(Object(o)),a=0,u=i.length;a<u;a++){var c=i[a],s=Object.getOwnPropertyDescriptor(o,c);void 0!==s&&s.enumerable&&(r[c]=o[c])}}return r}t.exports={assign:e,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:e})}}},215:(t,e,r)=>{var n,o,i;void 0===(o="function"==typeof(n=i=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function o(){}function i(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=t({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(r);/^[\{\[]/.test(a)&&(r=a)}catch(t){}r=n.write?n.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var u="";for(var c in i)i[c]&&(u+="; "+c,!0!==i[c]&&(u+="="+i[c].split(";")[0]));return document.cookie=e+"="+r+u}}function a(t,r){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var u=i[a].split("="),c=u.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var s=e(u[0]);if(c=(n.read||n)(c,s)||e(c),r)try{c=JSON.parse(c)}catch(t){}if(o[s]=c,t===s)break}catch(t){}}return t?o[t]:o}}return o.set=i,o.get=function(t){return a(t,!1)},o.getJSON=function(t){return a(t,!0)},o.remove=function(e,r){i(e,"",t(r,{expires:-1}))},o.defaults={},o.withConverter=r,o}((function(){}))})?n.call(e,r,e,t):n)||(t.exports=o),t.exports=i()},976:function(t,e){var r,n;void 0===(n="function"==typeof(r=function(){var t=function(){},e={},r={},n={};function o(t,e){if(t){var o=n[t];if(r[t]=e,o)for(;o.length;)o[0](t,e),o.splice(0,1)}}function i(e,r){e.call&&(e={success:e}),r.length?(e.error||t)(r):(e.success||t)(e)}function a(e,r,n,o){var i,u,c=document,s=n.async,l=(n.numRetries||0)+1,f=n.before||t,h=e.replace(/^(css|img)!/,"");o=o||0,/(^css!|\.css$)/.test(e)?((u=c.createElement("link")).rel="stylesheet",u.href=h,(i="hideFocus"in u)&&u.relList&&(i=0,u.rel="preload",u.as="style")):/(^img!|\.(png|gif|jpg|svg)$)/.test(e)?(u=c.createElement("img")).src=h:((u=c.createElement("script")).src=e,u.async=void 0===s||s),u.onload=u.onerror=u.onbeforeload=function(t){var c=t.type[0];if(i)try{u.sheet.cssText.length||(c="e")}catch(t){18!=t.code&&(c="e")}if("e"==c){if((o+=1)<l)return a(e,r,n,o)}else if("preload"==u.rel&&"style"==u.as)return u.rel="stylesheet";r(e,c,t.defaultPrevented)},!1!==f(e,u)&&c.head.appendChild(u)}function u(t,r,n){var u,c;if(r&&r.trim&&(u=r),c=(u?n:r)||{},u){if(u in e)throw"LoadJS";e[u]=!0}function s(e,r){!function(t,e,r){var n,o,i=(t=t.push?t:[t]).length,u=i,c=[];for(n=function(t,r,n){if("e"==r&&c.push(t),"b"==r){if(!n)return;c.push(t)}--i||e(c)},o=0;o<u;o++)a(t[o],n,r)}(t,(function(t){i(c,t),e&&i({success:e,error:r},t),o(u,t)}),c)}if(c.returnPromise)return new Promise(s);s()}return u.ready=function(t,e){return function(t,e){t=t.push?t:[t];var o,i,a,u=[],c=t.length,s=c;for(o=function(t,r){r.length&&u.push(t),--s||e(u)};c--;)i=t[c],(a=r[i])?o(i,a):(n[i]=n[i]||[]).push(o)}(t,(function(t){i(e,t)})),u},u.done=function(t){o(t,[])},u.reset=function(){e={},r={},n={}},u.isDefined=function(t){return t in e},u})?r.apply(e,[]):r)||(t.exports=n)},916:()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var r=this.event&&this.event.type,n="unload"===r||"beforeunload"===r,o="XMLHttpRequest"in this?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");o.open("POST",t,!n),o.withCredentials=!0,o.setRequestHeader("Accept","*/*"),"string"==typeof e?(o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),o.responseType="text/plain"):e instanceof Blob&&e.type&&o.setRequestHeader("Content-Type",e.type);try{o.send(e)}catch(t){return!1}return!0}function r(){return"navigator"in this&&"sendBeacon"in this.navigator}(function(){r.call(this)||("navigator"in this||(this.navigator={}),this.navigator.sendBeacon=e.bind(this))}).call("object"===("undefined"==typeof window?"undefined":t(window))?window:{})},31:(t,e)=>{!function(t){var e,r,n,o=String.fromCharCode;function i(t){for(var e,r,n=[],o=0,i=t.length;o<i;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<i?56320==(64512&(r=t.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),o--):n.push(e);return n}function a(t){if(t>=55296&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function u(t,e){return o(t>>e&63|128)}function c(t){if(!(4294967168&t))return o(t);var e="";return 4294965248&t?4294901760&t?4292870144&t||(e=o(t>>18&7|240),e+=u(t,12),e+=u(t,6)):(a(t),e=o(t>>12&15|224),e+=u(t,6)):e=o(t>>6&31|192),e+o(63&t|128)}function s(){if(n>=r)throw Error("Invalid byte index");var t=255&e[n];if(n++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function l(){var t,o;if(n>r)throw Error("Invalid byte index");if(n==r)return!1;if(t=255&e[n],n++,!(128&t))return t;if(192==(224&t)){if((o=(31&t)<<6|s())>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&t)){if((o=(15&t)<<12|s()<<6|s())>=2048)return a(o),o;throw Error("Invalid continuation byte")}if(240==(248&t)&&(o=(7&t)<<18|s()<<12|s()<<6|s())>=65536&&o<=1114111)return o;throw Error("Invalid UTF-8 detected")}t.version="3.0.0",t.encode=function(t){for(var e=i(t),r=e.length,n=-1,o="";++n<r;)o+=c(e[n]);return o},t.decode=function(t){e=i(t),r=e.length,n=0;for(var a,u=[];!1!==(a=l());)u.push(a);return function(t){for(var e,r=t.length,n=-1,i="";++n<r;)(e=t[n])>65535&&(i+=o((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=o(e);return i}(u)}}(e)},471:t=>{for(var e=[],r=0;r<256;++r)e[r]=(r+256).toString(16).substr(1);t.exports=function(t,r){var n=r||0,o=e;return[o[t[n++]],o[t[n++]],o[t[n++]],o[t[n++]],"-",o[t[n++]],o[t[n++]],"-",o[t[n++]],o[t[n++]],"-",o[t[n++]],o[t[n++]],"-",o[t[n++]],o[t[n++]],o[t[n++]],o[t[n++]],o[t[n++]],o[t[n++]]].join("")}},814:t=>{var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var r=new Uint8Array(16);t.exports=function(){return e(r),r}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)3&e||(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}},550:(t,e,r)=>{var n=r(814),o=r(471);t.exports=function(t,e,r){var i=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var u=0;u<16;++u)e[i+u]=a[u];return e||o(a)}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var n={};return(()=>{"use strict";r.r(n),r.d(n,{HorizonClient:()=>Me,IDManager:()=>je,Settings:()=>_}),r(92);var t=r(550),e=r.n(t);const o=function(t,e){var r=(window.horizonResources=window.horizonResources||{},window.horizonResources);return r[t]=r[t]||e,r[t]},i={MINIMUM:50,MAXIMUM:1e3,DEFAULT:100},a={MINIMUM:1,MAXIMUM:100,DEFAULT:10},u={MINIMUM:5e3,MAXIMUM:2e4,DEFAULT:1e4};var c="QUEUE_STATUS",s="SEND_STATUS",l="ID_STATUS",f="SCHEMAS_STATUS",h="REQUEUING_STATUS",p="VALIDATION_STATUS",y="DISCARDED_BY_OVERFLOW",v="DISCARDED_BY_EXPIRED",d="QUEUE_VALIDATED_CURRENT_SIZE",m="SEND_FAILURE",g="IO_EXCEPTION",b="SUCCESS",E="FAILED",w={AVOID_COOKIE_USAGE:!1,EVENTS_BUFFER_SIZE:100,EVENTS_SENDER_INTERVAL:1e4,EVENTS_SENDER_MIN_INTERVAL:5e3,EVENTS_SENDER_MAX_INTERVAL:3e4,EVENTS_DISCARD_AFTER_MSECS:36e5,EVENTS_BULK_SIZE:10,HORIZON_CALLBACK_STACK_LIMIT:1e3,HORIZON_CONFIGS_HOST:"https://horizon-config-api-gcp-us-prod.apps.tsuru.gcp.i.globo/",HORIZON_TRACK_IDENTIFICATION_RESOURCE:"id",HORIZON_TRACK_HOST:"horizon-track.globo.com",HORIZON_CLIENT_UUID:o("clientInstanceUUID",e()()),HORIZON_REQUEST_ENCODING:"base64",HORIZON_SCHEMAS_HOST:"horizon-schemas.globo.com",IDENTIFICATION_LOAD_RETRY_AFTER_MSECS:5e3,PACKAGE_VERSION:"3.6.0",SCHEMA_VALIDATOR_SCRIPT_URL:"s3.glbimg.com/cdn/libs/tv4/1.3.0/tv4.min.js",SCHEMA_VALIDATOR_SCRIPT_MAX_RETRIES:2,SCHEMA_LOAD_COLLECTION_RETRY_AFTER_MSECS:1e4,USE_HTTPS:!0,METRICS_SEND_INTERVAL:18e4},S=function(t,e,r,n){w[t]=e<=r?r:e>=n?n:e},I={avoidCookieUsage:function(){w.AVOID_COOKIE_USAGE=!0},useHTTPOnly:function(){w.USE_HTTPS=!1},useQAConfiguration:function(){w.HORIZON_TRACK_HOST="horizon-track.qa.globoi.com",w.HORIZON_SCHEMAS_HOST="horizon-schemas.qa.globoi.com",w.HORIZON_CONFIGS_HOST="horizon-config-api-gcp-qa.rpaasv2-be.tsuru.dev.gcp.i.globo",w.HORIZON_REQUEST_ENCODING="json"},useJSONEncoding:function(){w.HORIZON_REQUEST_ENCODING="json"},changeEventbusBufferSize:function(t){if(t&&Number.isInteger(t)&&!(t<=0)){var e=i,r=e.MINIMUM,n=e.MAXIMUM;S("EVENTS_BUFFER_SIZE",t,r,n),console.log("changeEventbusBufferSize: ".concat(t))}},changeEventbusBulkSize:function(t){if(t&&Number.isInteger(t)&&!(t<=0)){var e=a,r=e.MINIMUM,n=e.MAXIMUM;S("EVENTS_BULK_SIZE",t,r,n)}},changeEventbusSenderInterval:function(t){if(t&&Number.isInteger(t)&&!(t<=0)){var e=u,r=e.MINIMUM,n=e.MAXIMUM;S("EVENTS_SENDER_INTERVAL",t,r,n)}}};const _=Object.assign(w,I);var O=r(976),T=r.n(O),N={COMPONENT_NOT_READY:"[Horizon] Component is not ready.",COMPONENT_UNAVAILABLE:"[Horizon] Class or function is required.",DUPLICATED_SCHEMA:"[Horizon] Duplicated schema.",ERROR_LOADING_RESOURCE:"[Horizon] Failed to load resource.",INVALID_AUTH_TOKEN:"[Horizon] Invalid authorization token.",INVALID_DATA:"[Horizon] Invalid data.",INVALID_DATE:"[Horizon] Invalid date-time RFC 3339 format.",INVALID_STRING_NUMERIC_STRING:"[Horizon] numericString should be string.",INVALID_EMPTY_NUMERIC_STRING:"[Horizon] numericString should be empty.",INVALID_NUMERIC_STRING:"[Horizon] Invalid number. Field with NumericString must to be number.",INVALID_ENVIRONMENT:"[Horizon] Invalid environment value.",INVALID_FORMAT:"[Horizon] Invalid event format.",INVALID_REQUEST:"[Horizon] Invalid request.",INVALID_TIMESTAMP:"[Horizon] Invalid timestamp.",INVALID_VERSION_FORMAT:"[Horizon] Invalid version format.",INVALID_RELATION_ID:"[Horizon] Invalid relation identification.",LIMIT_EXCEEDED:"[Horizon] Resource limit exceeded.",MUST_BE_DEFINED:"[Horizon] Parameter or argument must be defined",SCHEMA_VALIDATOR_ERROR_LOADING:"[Horizon] Could not load SchemaValidator.",UNSUPPORTED_TYPE:"[Horizon] Unsupported type.",UNSUPPORTED_TENANT:"[Horizon] Unsupported tenant.",UNSUPPORTED_ENCODER:"[Horizon] Unsupported encoder.",USE_MANAGER_ONLY_WHEN_AVOIDING_COOKIE:"[Horizon] Can not set or remove a logged user when AVOID_COOKIE_USAGE is not enabled."},L={mustBeDefined:function(t){throw new Error("".concat(N.MUST_BE_DEFINED,": ").concat(t,"."))}};const A=Object.assign(N,L);function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function R(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,x(n.key),n)}}function x(t){var e=function(t){if("object"!=C(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==C(e)?e:e+""}const D=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=new Map},e=[{key:"addMetric",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])this.data.set(t,e);else{var r=this.data.get(t)||0;this.data.set(t,r+e)}}},{key:"getMetrics",value:function(){return new Map(this.data)}}],e&&R(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function M(t,e,r){return(e=P(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function j(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,P(n.key),n)}}function P(t){var e=function(t){if("object"!=k(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==k(e)?e:e+""}var U=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.metricCollectors=M(M(M(M(M(M({},c,{}),s,{}),l,{}),f,{}),h,{}),p,{}),this.allTenants=[],this.initialQueueSizeValidated=0,this.initialQueueSizeUnvalidated=0,this.horizonClientUUID={}},e=[{key:"addMetric",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"general";null!==t&&(this.metricCollectors[t][n]||(this.metricCollectors[t][n]=new D,"general"===n||this.allTenants.includes(n)||this.allTenants.push(n)),t===c&&e===d?this.metricCollectors[t][n].addMetric(e,r,!0):this.metricCollectors[t][n].addMetric(e,r))}},{key:"getMetrics",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general";return this.metricCollectors[t]&&this.metricCollectors[t][e]?this.metricCollectors[t][e].getMetrics():null}},{key:"addHttpMetric",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"general";null!==t&&(this.metricCollectors[t][n]||(this.metricCollectors[t][n]=new D,"general"===n||this.allTenants.includes(n)||this.allTenants.push(n)),this.metricCollectors[t][n].addMetric(e,r))}},{key:"getHttpMetrics",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general";return this.metricCollectors[t]&&this.metricCollectors[t][e]?this.metricCollectors[t][e].getMetrics():null}},{key:"setCurrentHorizonClientUUID",value:function(t,e){this.horizonClientUUID[t]=e}},{key:"getCurrentHorizonClientUUID",value:function(t){return this.horizonClientUUID[t]}},{key:"getAllTenants",value:function(){return this.allTenants}}],e&&j(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const H=function(){var t=o("metrics",{});return t.metricCollector||(t.metricCollector=new U),t.metricCollector};function V(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function G(t,e,r){return(e=function(t){var e=function(t){if("object"!=z(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==z(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}var F={ready:[]},q=["url"],B=function(){return!!window.tv4},Z=function(t){return null===t||isNaN(t)&&!isNaN(Date.parse(t))?null:A.INVALID_DATE},K=function(t){return"string"!=typeof t?A.INVALID_STRING_NUMERIC_STRING:""===t.trim()?A.INVALID_EMPTY_NUMERIC_STRING:Number.isFinite(Number(t))?null:A.INVALID_NUMERIC_STRING};const Q={validateFor:function(t,e,r){var n=H();if(!B())throw new Error("".concat(A.ERROR_LOADING_RESOURCE," Validator is not ready."));if(!e)throw n.addMetric(p,E,1,r),new Error("".concat(A.INVALID_DATA," Argument: schema."));if(!/\d+\.\d+/.test(t.version))throw n.addMetric(p,E,1,r),new Error(A.INVALID_VERSION_FORMAT);if(!tv4.validate(t.properties,e))throw n.addMetric(p,E,1,r),new Error("".concat(A.INVALID_DATA," ").concat(t.id," ").concat(t.version,". ").concat(tv4.error))},validateArgs:function(t,e){var r=H(),n=Object.prototype.hasOwnProperty;if(!(t&&n.call(t,"id")&&n.call(t,"version")&&n.call(t,"properties")))throw r.addMetric(p,E,1,e),new Error("".concat(A.INVALID_FORMAT," Missing properties: ").concat(JSON.stringify(t)));if("string"!=typeof t.id||"string"!=typeof t.version||"object"!==z(t.properties))throw r.addMetric(p,E,1,e),new Error("".concat(A.INVALID_FORMAT," Wrong object type: ").concat(JSON.stringify(t)));if(q.filter((function(e){return t[e]&&"string"!=typeof t[e]})).length>0)throw r.addMetric(p,E,1,e),new Error("".concat(A.INVALID_FORMAT," Wrong object type: ").concat(JSON.stringify(t)));if(t.id.length<2||t.version.length<3)throw r.addMetric(p,E,1,e),new Error("".concat(A.INVALID_FORMAT," Invalid property size: ").concat(JSON.stringify(t)));var o=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?V(Object(r),!0).forEach((function(e){G(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t);delete o.id,delete o.version,delete o.properties,delete o.contentType;var i=Object.keys(o);if(i.length>0&&!i.every((function(t){return-1!==q.indexOf(t)})))throw r.addMetric(p,E,1,e),new Error("".concat(A.INVALID_FORMAT," Extra keys aren't allowed: ").concat(JSON.stringify(o)))},tv4IsValidData:Z,tv4IsNumericString:K,isReady:B,onReady:function(t){if(B())return t();if(F.ready.length>_.HORIZON_CALLBACK_STACK_LIMIT)throw new Error("".concat(A.LIMIT_EXCEEDED," Validator callback stack."));return F.ready.unshift(t)},load:function(){if(!T().isDefined("tv4")){var t=_.USE_HTTPS?"https://":"http://",e="".concat(t).concat(_.SCHEMA_VALIDATOR_SCRIPT_URL);T()([e],"tv4",{async:!0,numRetries:_.SCHEMA_VALIDATOR_SCRIPT_MAX_RETRIES,success:function(){tv4.addFormat("date-time",Z),tv4.addFormat("numericString",K),F.ready.forEach((function(t){return t()}))},error:function(t){throw new Error("".concat(A.SCHEMA_VALIDATOR_ERROR_LOADING," ").concat(t))}})}}};function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function X(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?J(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$(n.key),n)}}function $(t){var e=function(t){if("object"!=Y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}const tt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.metricCollector=e},(e=[{key:"formatQueueMetric",value:function(t){var e=v,r=y,n=d;return[{queueOverflow:t&&t.get(r)||0,expired:t&&t.get(e)||0,validatedCurrentSize:t&&t.get(n)||0,unvalidatedCurrentSize:t&&t.get("QUEUE_UNVALIDATED_CURRENT_SIZE")||0}]}},{key:"formatSendStatusHttpCodeMetric",value:function(t){return t?Array.from(t.entries()).map((function(t){var e=X(t,2);return{sendStatusCode:e[0],sendStatusQuantity:e[1]}})):[]}},{key:"formatIdStatusHttpCodeMetric",value:function(t){return t?Array.from(t.entries()).map((function(t){var e=X(t,2);return{idStatusCode:e[0],idStatusQuantity:e[1]}})):[]}},{key:"formatSchemaStatusHttpCodeMetric",value:function(t){return t?Array.from(t.entries()).map((function(t){var e=X(t,2);return{schemaStatusCode:e[0],schemaStatusQuantity:e[1]}})):[]}},{key:"formatRequeuingMetric",value:function(t){var e=m,r=g;return[{requeuingStatusResponse:e.toLowerCase(),requeuingStatusQuantity:t&&t.get(e)||0},{requeuingStatusResponse:r.toLowerCase(),requeuingStatusQuantity:t&&t.get(r)||0}]}},{key:"formatValidationMetric",value:function(t){var e=b,r=E;return[{validationStatusResponse:e.toLowerCase(),validationStatusQuantity:t&&t.get(e)||0},{validationStatusResponse:r.toLowerCase(),validationStatusQuantity:t&&t.get(r)||0}]}},{key:"formatConfigurationStatusMetric",value:function(t){var e=_.USE_HTTPS,r=_.AVOID_COOKIE_USAGE,n=_.HORIZON_TRACK_HOST,o=_.HORIZON_SCHEMAS_HOST,i=_.HORIZON_REQUEST_ENCODING,a=_.EVENTS_BUFFER_SIZE,u=_.EVENTS_BULK_SIZE,c=_.EVENTS_SENDER_INTERVAL;return JSON.stringify({USE_HTTPS:e,AVOID_COOKIE_USAGE:r,HORIZON_TRACK_HOST:n,HORIZON_SCHEMAS_HOST:o,HORIZON_REQUEST_ENCODING:i,EVENTS_BUFFER_SIZE:a,EVENTS_BULK_SIZE:u,EVENTS_SENDER_INTERVAL:c,HORIZON_CLIENT_UUID:this.metricCollector.getCurrentHorizonClientUUID(t),TENANTS_IN_INSTANCE:this.metricCollector.getAllTenants()})}},{key:"reportAllMetrics",value:function(t){var e=this.metricCollector.getHttpMetrics(s,t),r=this.metricCollector.getHttpMetrics(l),n=this.metricCollector.getHttpMetrics(f),o=this.metricCollector.getMetrics(c,t),i=this.metricCollector.getMetrics(h,t),a=this.metricCollector.getMetrics(p,t);return{id:"horizon-sdk-metrics",version:"1.1",contentType:"metrics",properties:{queueStatus:this.formatQueueMetric(o),sendStatus:this.formatSendStatusHttpCodeMetric(e),idStatus:this.formatIdStatusHttpCodeMetric(r),schemaStatus:this.formatSchemaStatusHttpCodeMetric(n),requeuingStatus:this.formatRequeuingMetric(i),validationStatus:this.formatValidationMetric(a),configurationStatus:this.formatConfigurationStatusMetric(t)}}}}])&&W(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function et(t){return et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},et(t)}function rt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,nt(n.key),n)}}function nt(t){var e=function(t){if("object"!=et(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=et(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==et(e)?e:e+""}var ot=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lastMetricsSentTimestamp={},this.metricsSendInterval=e,this.initialDelaySet=r,this.wasFirstSend={}},(e=[{key:"shouldSendMetricsNow",value:function(t){var e=Date.now();return e-(this.lastMetricsSentTimestamp[t]||0)+100>=(this.wasFirstSend[t]?this.metricsSendInterval:this.initialDelaySet)&&(this.lastMetricsSentTimestamp[t]=e,this.wasFirstSend[t]=!0,!0)}}])&&rt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function it(t){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it(t)}function at(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ut(n.key),n)}}function ut(t){var e=function(t){if("object"!=it(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=it(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==it(e)?e:e+""}const ct=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.interval=0,this.tickIntervalId=0,this.callbacks=[]},(e=[{key:"isRunning",get:function(){return!!this.tickIntervalId}},{key:"tick",value:function(){var t=this;this.callbacks.forEach((function(e){return e(t)}))}},{key:"start",value:function(){return this.tickIntervalId=setInterval(this.tick.bind(this),this.interval),this}},{key:"stop",value:function(){return clearInterval(this.tickIntervalId),this.tickIntervalId=0,this}},{key:"reschedule",value:function(t){return this.stop().every(t).start()}},{key:"every",value:function(t){return this.interval=t,this}},{key:"call",value:function(t){return this.callbacks.push(t),this}}])&&at(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();r(916);var st=r(215),lt=r.n(st);const ft=function(t){var e=_.EVENTS_SENDER_MIN_INTERVAL,r=_.EVENTS_SENDER_MAX_INTERVAL,n=Number(lt().get("_hzt.interval"))||_.EVENTS_SENDER_INTERVAL;n<=r&&n>=e&&t.interval!==n&&t.reschedule(n)};function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function vt(t){var e=function(t){if("object"!=ht(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ht(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ht(e)?e:e+""}var dt=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.MAXIMUM,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._queue=[],this.maxSize=r,this.metricCollector=n,this.queueName=e}return e=t,n=[{key:"fromArray",value:function(e,r){var n=new t(this.productName,r,this.metricCollector);return e.forEach((function(t){return n.push(t)})),n}}],(r=[{key:"length",get:function(){return this._queue.length}},{key:"items",get:function(){return JSON.parse(JSON.stringify(this._queue))}},{key:"push",value:function(t){this.metricDiscardedEvents(),this._queue=[t].concat(function(t){return function(t){if(Array.isArray(t))return pt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return pt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?pt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.slice(0,this.maxSize-1)))}},{key:"metricDiscardedEvents",value:function(){if(this.metricCollector){var t=this._queue.length;this.slice(0,this.maxSize-1).length<t&&this.metricCollector.addMetric(c,y,this.queueName)}}},{key:"forEach",value:function(t){return this._queue.forEach(t)}},{key:"slice",value:function(t,e){return this._queue.slice(t,e)}},{key:"splice",value:function(t,e){return this._queue.splice(t,e)}},{key:"clear",value:function(){this._queue=[]}},{key:"filter",value:function(e){return t.fromArray(this._queue.filter(e),this.maxSize)}}])&&yt(e.prototype,r),n&&yt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n}();const mt=dt;var gt=r(914),bt=r.n(gt),Et=r(31),wt=r.n(Et),St={base64:function(t){var e=new FormData;return e.append("data",bt().encode(wt().encode(JSON.stringify(t)))),e.append("encoding","base64"),e},json:function(t){return JSON.stringify(t)}};function It(t){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},It(t)}function _t(){_t=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),u=new C(n||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",d={};function m(){}function g(){}function b(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(E=S);var I=b.prototype=m.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==It(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=h;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=N(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function N(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(It(e)+" is not iterable")}return g.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},_(O.prototype),s(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(I),s(I,c,"Generator"),s(I,a,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Ot(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}var Tt=function(t,e,r){var n=r.status,o=r.statusText,i=r.response;n>=200&&n<400?t({status:n,statusText:o,data:JSON.parse(i)}):e({status:n,statusText:o})};const Nt={request:function(t,e){return new Promise((function(r,n){var o=new XMLHttpRequest;o.open(t,e,!0),o.onload=function(){return Tt(r,n,o)},o.onerror=function(t){return n(t)},o.send()}))},post:function(){var t,e=(t=_t().mark((function t(e,r,n){return _t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,o){var i=new XMLHttpRequest;i.open("POST",e,!0),i.withCredentials=!0,Object.keys(r).forEach((function(t){i.setRequestHeader(t,r[t])})),i.onload=function(){return Tt(t,o,i)},i.onerror=function(t){return o(t)},i.send(JSON.stringify(n))})));case 1:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ot(i,n,o,a,u,"next",t)}function u(t){Ot(i,n,o,a,u,"throw",t)}a(void 0)}))});return function(t,r,n){return e.apply(this,arguments)}}()};function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function At(){At=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),u=new C(n||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",d={};function m(){}function g(){}function b(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(E=S);var I=b.prototype=m.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Lt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=h;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=N(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function N(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Lt(e)+" is not iterable")}return g.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},_(O.prototype),s(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(I),s(I,c,"Generator"),s(I,a,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Ct(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Rt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ct(i,n,o,a,u,"next",t)}function u(t){Ct(i,n,o,a,u,"throw",t)}a(void 0)}))}}function xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Dt(n.key),n)}}function Dt(t){var e=function(t){if("object"!=Lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Lt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lt(e)?e:e+""}var kt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"send",value:(o=Rt(At().mark((function t(e,r){var n,o,i,a=arguments;return At().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>2&&void 0!==a[2]?a[2]:"json",r){t.next=3;break}return t.abrupt("return",null);case 3:return o=this.preparePayload(r,n),i={isSent:!1,status:0},i=this.sendBySendBeacon(e,o),t.next=8,this.sendByFetch(e,o,i);case 8:return i=t.sent,t.next=11,this.sendByXMLHttpRequest(e,o,n,i);case 11:return i=t.sent,t.abrupt("return",i);case 13:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"preparePayload",value:function(t,e){return function(t){if(!(t in St))throw new Error("".concat(A.UNSUPPORTED_ENCODER," Invalid ").concat(t," encoder."));return St[t]}(e)(t)}},{key:"sendBySendBeacon",value:function(t,e){var r=!1;try{r=navigator.sendBeacon(t,e)}catch(t){r=!1}return{isSent:r,status:200}}},{key:"sendByFetch",value:(n=Rt(At().mark((function t(e,r,n){return At().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.isSent){t.next=2;break}return t.abrupt("return",n);case 2:return t.abrupt("return",fetch(e,{method:"POST",credentials:"include",body:r}).then((function(t){return t.ok||console.error("Failed to send Horizon events using fetch. Status ".concat(t.status," - ").concat(t.statusText)),{isSent:t.ok,status:t.status}})).catch((function(t){return{isSent:!1,status:t.status||-1}})));case 3:case"end":return t.stop()}}),t)}))),function(t,e,r){return n.apply(this,arguments)})},{key:"sendByXMLHttpRequest",value:(r=Rt(At().mark((function t(e,r,n,o){var i;return At().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!o.isSent){t.next=2;break}return t.abrupt("return",o);case 2:return i={},"json"===n&&(i={"Content-Type":"application/json"}),t.abrupt("return",Nt.post(e,i,r).then((function(t){return{isSent:!0,status:t.status}})).catch((function(t){return{isSent:!1,status:t.status||-1}})));case 5:case"end":return t.stop()}}),t)}))),function(t,e,n,o){return r.apply(this,arguments)})}],e&&xt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();function Mt(t){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(t)}function jt(){jt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),u=new C(n||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",d={};function m(){}function g(){}function b(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(E=S);var I=b.prototype=m.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Mt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=h;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=N(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function N(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Mt(e)+" is not iterable")}return g.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},_(O.prototype),s(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(I),s(I,c,"Generator"),s(I,a,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Pt(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Ut(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Pt(i,n,o,a,u,"next",t)}function u(t){Pt(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Vt(n.key),n)}}function Vt(t){var e=function(t){if("object"!=Mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Mt(e)?e:e+""}var Gt=function(){return t=function t(e,r,n,o,i,a){var u=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.currentTenant=e||A.mustBeDefined("tenant"),this.instanceID=r||A.mustBeDefined("instanceID"),this.deviceGroup=n||A.mustBeDefined("deviceGroup"),this.environment=o||A.mustBeDefined("environment"),this.metricCollector=a,this.queue=new mt(this.currentTenant,_.EVENTS_BUFFER_SIZE,this.metricCollector),this.idManager=i,this.dispatchNumber=1,this.actionCounter=0,this.dispatcher=new kt,this.metricCollector.setCurrentHorizonClientUUID(this.currentTenant,r),(new ct).every(_.EVENTS_SENDER_INTERVAL).call(Ut(jt().mark((function t(){var e;return jt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u.queue=u.filterQueue(),e=u.prepareRequest(),t.next=4,u.dispatch(e,_.HORIZON_REQUEST_ENCODING);case 4:t.sent||e.actions.forEach((function(t){return u.enqueue(t)}));case 6:case"end":return t.stop()}}),t)})))).call(ft).start()},e=[{key:"length",get:function(){return this.queue.length}},{key:"setMaxQueueSize",value:function(t){this.queue=mt.fromArray(this.queue.items,t)}},{key:"filterQueue",value:function(){var t=+Date.now()-_.EVENTS_DISCARD_AFTER_MSECS,e=this.queue.length,r=this.queue.filter((function(e){return e.actionTs>t})),n=e-r.length;return this.metricCollector.addMetric(c,v,n,this.currentTenant),r}},{key:"prepareRequest",value:function(){var t=this.queue.splice(0,_.EVENTS_BULK_SIZE);return this.metricCollector.addMetric(c,d,this.queue.length,this.currentTenant),this.actionCounter+=t.length,{horizonClientUUID:this.instanceID,horizonClientTenant:this.currentTenant,horizonClientTs:Date.now(),horizonClientType:"js",horizonClientDeviceGroup:this.deviceGroup,horizonDispatchNumber:this.dispatchNumber,horizonActionCounter:this.actionCounter,horizonEnvironment:this.environment,actions:t}}},{key:"isValidRequest",value:function(t){if(!t||t&&!t.actions)throw new Error(A.INVALID_REQUEST);return t.actions.length>0}},{key:"prepareUrl",value:function(){var t=_.USE_HTTPS?"https://":"http://",e=this.idManager.getAsKeyValue(),r=e?"?".concat(e):"";return"".concat(t).concat(lt().get("_hzt.host")||_.HORIZON_TRACK_HOST,"/event/").concat(this.currentTenant).concat(r)}},{key:"dispatch",value:(r=Ut(jt().mark((function t(e){var r,n,o,i,a=arguments;return jt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:"json",this.isValidRequest(e)){t.next=3;break}return t.abrupt("return",!1);case 3:return n=e.actions.length,o=this.prepareUrl(),this.dispatchNumber+=1,t.next=8,this.dispatcher.send(o,e,r);case 8:return i=t.sent,this.handleMetrics(i.isSent,i.status,n),t.abrupt("return",i.isSent);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"handleMetrics",value:function(t,e,r){if(this.metricCollector.addHttpMetric(s,e,r,this.currentTenant),!t){var n=-1===e?g:m;this.metricCollector.addHttpMetric(h,n,r,this.currentTenant)}}},{key:"enqueue",value:function(t){if(!t.actionTs)throw new Error(A.INVALID_TIMESTAMP);this.queue.push(t),this.metricCollector.addMetric(c,d,this.queue.length,this.currentTenant)}},{key:"flush",value:function(){for(;this.queue.length>0;){this.queue=this.filterQueue();var t=this.prepareRequest();this.dispatch(t,_.HORIZON_REQUEST_ENCODING)}}}],e&&Ht(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();const zt=function(t,e,r,n){var i=o("bus",{}),a="".concat(t,"-").concat(e);return i[a]||(i[a]=new Gt(t,_.HORIZON_CLIENT_UUID,e,r,n,H())),i[a]},Ft=function(t,e){setTimeout((function(){return t(e)}),1)};function qt(t){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt(t)}function Bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Zt(n.key),n)}}function Zt(t){var e=function(t){if("object"!=qt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=qt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qt(e)?e:e+""}var Kt="statusReady",Qt="statusNotReady",Yt="statusError",Xt=function(){return o("schemas",{data:{}})},Jt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.url=e,this.state=Qt,this.metricCollector=H(),this.callbacks={onReady:[],onError:[],onRetry:[],onLoad:[]}},(e=[{key:"get",value:function(t,e){var r="".concat(t,"-").concat(e);if(!this.isReady())throw new Error("".concat(A.COMPONENT_NOT_READY));var n=Xt().data[r];if(!n)throw new Error("".concat(A.UNSUPPORTED_TYPE,": ").concat(r));return n}},{key:"isReady",value:function(){return this.state===Kt}},{key:"retry",value:function(){var t=this;this.state="statusScheduled",this.callbacks.onRetry.forEach((function(t){return t()})),setTimeout((function(){t.state=Qt,t.load()}),_.SCHEMA_LOAD_COLLECTION_RETRY_AFTER_MSECS)}},{key:"onLoad",value:function(t){this.callbacks.onLoad.push(t)}},{key:"onRetry",value:function(t){this.callbacks.onRetry.push(t)}},{key:"onReady",value:function(t){if(this.state===Kt)return t(Xt().data);if(this.callbacks.onReady.length>_.HORIZON_CALLBACK_STACK_LIMIT)throw new Error("".concat(A.LIMIT_EXCEEDED," Schemas callback stack."));return this.callbacks.onReady.push(t)}},{key:"onError",value:function(t){this.state===Yt?t():this.callbacks.onError.push(t)}},{key:"load",value:function(){var t=this,e=Xt();if(this.state===Qt){this.state="statusLoading",this.callbacks.onLoad.forEach((function(t){return t()}));var r=_.USE_HTTPS?"https://":"http://";Nt.request("GET","".concat(r).concat(this.url)).then((function(r){var n=r.status,o=r.data;e.data=Object.assign(e.data||{},o),t.metricCollector.addHttpMetric(f,n),t.state=Kt,t.callbacks.onReady.forEach((function(t){return Ft(t,e.data)}))})).catch((function(e){var r=e.status;t.metricCollector.addHttpMetric(f,r),t.state=Yt,t.callbacks.onError.forEach((function(t){return Ft(t,e)})),t.retry()}))}}}])&&Bt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Wt(t){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wt(t)}function $t(){$t=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),u=new C(n||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",d={};function m(){}function g(){}function b(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(E=S);var I=b.prototype=m.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Wt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=h;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=N(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function N(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Wt(e)+" is not iterable")}return g.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},_(O.prototype),s(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(I),s(I,c,"Generator"),s(I,a,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function te(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function ee(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){te(i,n,o,a,u,"next",t)}function u(t){te(i,n,o,a,u,"throw",t)}a(void 0)}))}}function re(){return ne.apply(this,arguments)}function ne(){return(ne=ee($t().mark((function t(){var e,r,n;return $t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=_.USE_HTTPS?"https://":"http://",t.prev=2,t.next=5,Nt.request("GET","".concat(e).concat(""));case 5:return r=t.sent,n=r.data,t.abrupt("return",n.Config);case 10:return t.prev=10,t.t0=t.catch(2),t.abrupt("return",null);case 13:case"end":return t.stop()}}),t,null,[[2,10]])})))).apply(this,arguments)}const oe={getConfig:function(){var t=ee($t().mark((function t(e){var r,n;return $t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=o("sampling",{}))[e]){t.next=6;break}return t.next=4,re();case 4:n=t.sent,r[e]=n||{platform:"js",sample:[{schema:"horizon-sdk-metrics",sampling:.05}],tenant:"".concat(e)};case 6:return t.abrupt("return",r[e]);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()};var ie=function(t){return window.cdaaas&&window.cdaaas.SETTINGS?window.cdaaas.SETTINGS[t]:null},ae=function(t){return window.utag_data?window.utag_data[t]:null};function ue(){ue=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),u=new C(n||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",d={};function m(){}function g(){}function b(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(E=S);var I=b.prototype=m.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==le(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=h;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=N(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function N(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(le(e)+" is not iterable")}return g.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},_(O.prototype),s(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(I),s(I,c,"Generator"),s(I,a,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function ce(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function se(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ce(i,n,o,a,u,"next",t)}function u(t){ce(i,n,o,a,u,"throw",t)}a(void 0)}))}}function le(t){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},le(t)}function fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,he(n.key),n)}}function he(t){var e=function(t){if("object"!=le(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==le(e)?e:e+""}var pe=function(){return o("idManager",{loggedIDs:null,anonymousIDs:null,sessionIDs:null})},ye=["GLBID","GST","EXT_ID","globoId"],ve="statusReady",de="statusNotReady",me="statusError",ge=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.state=r?ve:de,this.metricCollector=H(),this.url=e,this.bypass=r,this.callbacks={onReady:[],onError:[],onRetry:[],onLoad:[]}},e=[{key:"onLoad",value:function(t){this.callbacks.onLoad.push(t)}},{key:"onRetry",value:function(t){this.callbacks.onRetry.push(t)}},{key:"onReady",value:function(t){if(this.state===ve)return t(this.getClientIDs());if(this.callbacks.onReady.length>_.HORIZON_CALLBACK_STACK_LIMIT)throw new Error("".concat(A.LIMIT_EXCEEDED," IDManager callback stack."));return this.callbacks.onReady.push(t)}},{key:"onError",value:function(t){this.state===me?t():this.callbacks.onError.push(t)}},{key:"getAsKeyValue",value:function(){if(!this.isReady())throw new Error("".concat(A.COMPONENT_NOT_READY));if(this.bypass)return"";var t=this.getClientIDs();return Object.keys(t).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t[e]))})).join("&")}},{key:"getClientIDs",value:function(){var t=pe();return Object.assign(t.loggedIDs||{},t.anonymousIDs||{},t.sessionIDs||{})}},{key:"isReady",value:function(){return this.state===ve}},{key:"retry",value:function(){var t=this;this.state="statusScheduled",this.callbacks.onRetry.forEach((function(t){return t()})),setTimeout((function(){t.state=de,t.load()}),_.IDENTIFICATION_LOAD_RETRY_AFTER_MSECS)}},{key:"setLoggedUser",value:function(t,e){if(-1===ye.indexOf(t))throw Error(A.INVALID_AUTH_TOKEN);var r,n,o,i=pe();i.loggedIDs=Object.assign(i.loggedIDs||{},(r={},o=e,(n=he(n=t))in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,r))}},{key:"setAnonymousUser",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=pe();if(null==r.anonymousIDs||e){if(!("glb_uid"in t)||!("glb_uid_public"in t)||!("glbuidjwt"in t))throw A.mustBeDefined("glb_uid, glb_uid_public and glbuidjwt");var n={glb_uid:t.glb_uid,glb_uid_public:t.glb_uid_public,glbuidjwt:t.glbuidjwt};r.anonymousIDs=Object.assign(r.anonymousIDs||{},n)}}},{key:"getAnonymousUser",value:function(){return pe().anonymousIDs}},{key:"getHsid",value:function(){return pe().sessionIDs}},{key:"setSessionID",value:function(t){t.hsid&&(pe().sessionIDs={hsid:t.hsid})}},{key:"removeLoggedUser",value:function(){var t=pe();ye.forEach((function(e){t.loggedIDs[e]&&delete t.loggedIDs[e]}))}},{key:"load",value:function(){var t=this;if(this.state===de){this.state="statusLoading",this.callbacks.onLoad.forEach((function(t){return t()}));var e=_.USE_HTTPS?"https://":"http://";Nt.request("GET","".concat(e).concat(this.url)).then((function(e){var r=e.status,n=e.data;t.metricCollector.addHttpMetric(l,r),t.setSessionID(n),t.setAnonymousUser(n,!1),t.state=ve,t.callbacks.onReady.forEach((function(e){return Ft(e,t.getClientIDs())}))})).catch((function(e){var r=e.status;t.metricCollector.addHttpMetric(l,r),t.state=me,t.callbacks.onError.forEach((function(t){return Ft(t,e)})),t.retry()}))}}}],e&&fe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),be=function(t){var e=pe();if(!e.instance){var r=t||"".concat(_.HORIZON_TRACK_HOST,"/").concat(_.HORIZON_TRACK_IDENTIFICATION_RESOURCE),n=!1===_.AVOID_COOKIE_USAGE;e.instance=new ge(r,n)}return e.instance},Ee=function(){var t=se(ue().mark((function t(e){var r;return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=be()).isReady()){t.next=4;break}return t.next=4,new Promise((function(t,e){r.onError((function(){e(new Error("Error loading IDManager"))})),r.onReady(t),r.load()}));case 4:return t.abrupt("return",e(r));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),we=function(){var t=se(ue().mark((function t(){var e,r,n;return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!_.AVOID_COOKIE_USAGE){t.next=6;break}if(e=be(),!(r=e.getAnonymousUser())){t.next=5;break}return t.abrupt("return",r);case 5:return t.abrupt("return",Ee((function(t){var e=t.getAnonymousUser();if(e)return e;throw new Error("Anonymous user not found")})));case 6:return n=lt().get("glb_uid"),t.abrupt("return",{glb_uid:n,glb_uid_public:void 0,glbuidjwt:void 0});case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();const Se={getInstance:be,getContextManager:pe,setLoggedUser:function(t,e){if(!_.AVOID_COOKIE_USAGE)throw Error(A.USE_MANAGER_ONLY_WHEN_AVOIDING_COOKIE);t&&0!==t.length||A.mustBeDefined("tokenName"),e&&0!==e.length||A.mustBeDefined("tokenValue"),be().setLoggedUser(t,e)},removeLoggedUser:function(){if(!_.AVOID_COOKIE_USAGE)throw Error(A.USE_MANAGER_ONLY_WHEN_AVOIDING_COOKIE);be().removeLoggedUser()},setAnonymousUser:function(t){be().setAnonymousUser(t)},getAnonymousUser:we,getHsid:function(){var t=se(ue().mark((function t(){var e;return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!_.AVOID_COOKIE_USAGE){t.next=5;break}return t.next=3,Ee(function(){var t=se(ue().mark((function t(e){return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getHsid());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:return e=t.sent,t.abrupt("return",e?e.hsid:void 0);case 5:return t.abrupt("return",lt().get("hsid"));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()};function Ie(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _e(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ie(Object(r),!0).forEach((function(e){Oe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ie(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Oe(t,e,r){return(e=Ce(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Te(t){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Te(t)}function Ne(){Ne=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),u=new C(n||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",d={};function m(){}function g(){}function b(){}var E={};s(E,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(E=S);var I=b.prototype=m.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Te(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=h;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=N(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?v:p,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function N(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Te(e)+" is not iterable")}return g.prototype=b,o(I,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},_(O.prototype),s(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(I),s(I,c,"Generator"),s(I,a,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Le(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Ae(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ce(n.key),n)}}function Ce(t){var e=function(t){if("object"!=Te(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Te(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Te(e)?e:e+""}var Re="stateNotReady",xe="stateLoading",De=["web","instant-article","app"],ke=function(){return t=function t(){var r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"web";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tenant=n||ie("SITE_ID")||ae("ut.profile")||"unknown",this.deviceGroup=i||ie("MOBILE_GROUP")||ae("platform")||"unknown",this.initialDelay=6e4,this.defaultContentType=a,-1===De.indexOf(u))throw Error(A.INVALID_ENVIRONMENT);this.environment=u,this.validator=Q,this.clientVersion=_.PACKAGE_VERSION,this.state=Re,this.referer=document.referrer;var c=null,s=null,l=null,f=null,h=null;this.configRemote=null,this.targetHorizonClientUUID=0,this.loadConfig(this.tenant);var p=function(){return o("horizonActionInfo",{horizonActionSequence:0,horizonClientContextID:e()()})};this.getHorizonActionSequence=function(){var t=p();return 2147483647===t.horizonActionSequence&&(t.horizonActionSequence=0),t.horizonActionSequence+=1,t.horizonActionSequence},this.getHorizonClientContextID=function(){return p().horizonClientContextID},this.getHorizonActionExtraAttributes=function(){return""},this.updateHorizonClientContextID=function(){p().horizonClientContextID=e()()},this.setMetricsCollector=function(t){f=t},this.getMetricsCollector=function(){if(!f){var t=H();r.setMetricsCollector(t)}return f},this.metricsReport=new tt(this.getMetricsCollector()),this.setMetricsManager=function(t){h=t},this.getMetricsManager=function(){if(!h){var t=(e=_.METRICS_SEND_INTERVAL,n=r.initialDelay,(i=o("metrics",{})).metricManager||(i.metricManager=new ot(e,n)),i.metricManager);r.setMetricsManager(t)}var e,n,i;return h},this.setSchemasProvider=function(t){c=t},this.getSchemasProvider=function(){if(!c){var t=((n=Xt()).provider||(n.provider=new Jt(e||"".concat(_.HORIZON_SCHEMAS_HOST,"/schemas"))),n.provider);r.setSchemasProvider(t)}var e,n;return c},this.setEventBus=function(t){s=t},this.getEventBus=function(){if(!s){var t=zt(r.tenant,r.deviceGroup,r.environment,r.getIdManager());r.setEventBus(t)}return s},this.setIdManager=function(t){l=t},this.getIdManager=function(){if(!l){var t=Se.getInstance();r.setIdManager(t)}return l},this.isReady=function(){return!!c&&!!l&&r.validator.isReady()&&c.isReady()&&l.isReady()},this.startScheduler=function(t){setTimeout((function(){r.sendMetrics(),(new ct).every(_.metricsInterval).call((function(){return r.sendMetrics()})).start()}),t)},this.startScheduler(this.initialDelay),this.normalizeUUID=function(t){for(var e=[],r=0;r<t.length;r+=2){var n=t.substr(r,2);e.push(parseInt(n,16))}return((e[0]<<24|e[1]<<16|e[2]<<8|e[3])+Math.pow(2,31))/(Math.pow(2,32)-1)},this.targetHorizonClientUUID=this.normalizeUUID(_.HORIZON_CLIENT_UUID),window.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&r.unload()}))},r=[{key:"loadConfig",value:(n=Ne().mark((function t(e){return Ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,oe.getConfig(e);case 2:this.configRemote=t.sent;case 3:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){Le(i,r,o,a,u,"next",t)}function u(t){Le(i,r,o,a,u,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})},{key:"useDefaultContentType",value:function(t){this.defaultContentType=t}},{key:"setValidator",value:function(t){this.validator=t}},{key:"setReferer",value:function(t){this.referer=t||document.referrer}},{key:"unload",value:function(){this.flush()}},{key:"getScopeInfo",value:function(t){return{url:document.location.href,actionTs:+Date.now(),horizonClientVersion:this.clientVersion,horizonClientReferer:this.referer,horizonRelationId:t,horizonActionUUID:e()(),horizonActionSequence:this.getHorizonActionSequence(),horizonClientContextID:this.getHorizonClientContextID(),horizonActionExtraAttributes:this.getHorizonActionExtraAttributes()}}},{key:"sendMetrics",value:function(){if(this.getMetricsManager().shouldSendMetricsNow(this.tenant)){var t=this.metricsReport.reportAllMetrics(this.tenant);this.send([t])}}},{key:"validateBeforeEnqueue",value:function(t){var e=this.getSchemasProvider().get(t.id,t.version);this.validator.validateFor(t,e,this.tenant),this.getMetricsCollector().addMetric(p,b,1,this.tenant)}},{key:"onReady",value:function(t){this.validator.isReady()?this.getSchemasProvider().isReady()?this.getIdManager().isReady()?(this.state="stateReady",t()):(this.state=xe,this.getIdManager().onReady(t),this.getIdManager().load()):(this.state=xe,this.getSchemasProvider().onReady(t),this.getSchemasProvider().load()):(this.state=xe,this.validator.onReady(t),this.validator.load())}},{key:"flush",value:function(){var t=this;this.isReady()?this.getEventBus().flush():this.onReady((function(){return t.flush()}))}},{key:"send",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=r&&"string"!=typeof r)throw new Error("".concat(A.INVALID_RELATION_ID," Wrong relationId type. It should be a String: actual type is ").concat(Te(r)));[].concat(t).forEach((function(t){if(e.configRemote&&e.configRemote.sample){var n=e.configRemote.sample.find((function(e){return e.schema===t.id}));if(n&&e.targetHorizonClientUUID>n.sampling)return}e.validator.validateArgs(t,e.tenant),e.sendWithInfo(t,e.getScopeInfo(r))}))}},{key:"sendWithInfo",value:function(t,e){var r=this;if(!this.isReady())return this.state===Re&&this.flush(),void this.onReady((function(){return r.sendWithInfo(t,e)}));this.validateBeforeEnqueue(t);var n=_e(_e({},e),t);n.contentType||(this.defaultContentType||A.mustBeDefined("contentType"),n.contentType=this.defaultContentType),this.getEventBus().enqueue(n)}},{key:"newContextId",value:function(){this.updateHorizonClientContextID()}},{key:"getContextId",value:function(){return this.getHorizonClientContextID()}}],r&&Ae(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,i}();const Me=ke;var je={setLoggedUser:Se.setLoggedUser,removeLoggedUser:Se.removeLoggedUser,setAnonymousUser:Se.setAnonymousUser,getAnonymousUser:Se.getAnonymousUser,getHsid:Se.getHsid}})(),n})()));